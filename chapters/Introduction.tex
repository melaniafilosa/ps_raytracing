\chapter{Introduction}
\section{Motivation}
Illumination optics is the branch of optics that deals with the design of optical systems for lighting. We restrict ourselves to the field of illumination optics which describes light in terms of ray: geometric optics. 
% Ray tracing (MC and QMC)
Currently, an increasing interest in designing light emitting
diode (LED) lighting is arising \cite{moreno2008modeling}. LED lighting has two main
advantages: first, its high energy efficacy; second, its very long lifetime, \cite{taguchi2008present, haitz2011solid}. For a lamp based on LED, an optical system is required
which consists of different optical components such
as lenses and reflectors. The goal in illumination optics is to
obtain the desired light output at the target after its propagation through the system.
\\ \indent To compute the photometric variables at the target of the
optical system, the ray tracing procedure is widely used \cite{glassner1989introduction}.
Ray tracing is a forward method which provides the light target distribution given a light source and an optical system \cite{Gross2005Handbook}. There are many ways to implement the ray tracing
process. Monte Carlo (MC) ray tracing is often used in nonimaging
optics. This method is based on a probabilistic interpretation
of the rays distribution at the source of the optical
system \cite{liu2010precise,Ting:1}: many rays are traced randomly from the source,
and their distribution at the target is estimated to compute the
photometric variables of the output light. Although the MC
procedure constitutes a robust method, it remains a slow and
numerically costly procedure, as it converges proportionally
to the reciprocal value of the square root of the number of rays
traced. \\ \indent To speed up MC ray tracing, deterministic Quasi-Monte Carlo (QMC) ray tracing was introduced. The difference between MC and QMC is that in the latter the coordinates of the rays traced are distributed according to a \textit{low-discrepancy sequences} (usually Sobol sequences), i.e. sequences close to uniformly distributed sequences \cite{levy2002introduction}. 
In some cases QMC ray tracing can constitutes an improvement of MC ray tracing \cite{ohbuchi1996quasi, caflisch1998monte}. However, is not possible to predict the convergence of QMC ray tracing as the error is always bounded by a term proportional to the discrepancy of the initial sample of rays. Furthermore, for in some cases the performances of the two method are comparable \cite{tuffin2004randomization}. 
\\ \indent The purpose of this thesis to provide tools to improve illumination optic design by using faster and more accurate methods than those in the current state-of-the-art.
To do that we analyze optical systems in the field of \textit{phase space optics} \cite{torre2005linear}.
The phase space (PS) of a line is described by the positions and directions coordinates of all the rays that propagate within the system \cite{testorf2009phase}. We restrict ourselves to the two-dimensional case which is particularly relevant as constitutes a good test case to
demonstrate the performance of the new ray tracing method.
Optical designers often start working in two dimensions where only the
meridional plane is taken into account. For any rotational symmetric
system the 2D case is very useful to study. 
The PS of a two-dimensional system is a two-dimensional space described by all the possible rays position and direction. The position coordinate is given by one of the two coordinates of the intersection point between the rays and the optical line, the direction coordinate is the sine of the angle that the ray form with the normal of the line encountered measured counterclockwise multiplied by the index of refraction of the material in which the line is located \cite{wolf2004geometric}. 
\\ \indent Optical phenomena can be analyzed by using the PS and the photometric variables can be defined in this plane \cite{rausch2014illumination}.  
For example, the \'{e}tendue can be seen as the area covered by the rays in phase space which can be calculated either using numerical integration or, for very simple systems, even analytically. The luminance is the power distribution in phase space. For systems formed by a Lambertian source the output luminance is a positive constant when different from zero. The intensity is given by an integration of the luminance along all the possible positions in phase space. Assuming a Lambertian source, the intensity along every direction is simply the support of the luminance given by the sum of the distances between the rays located on the boundaries of the regions with positive luminance. 
\\ \indent Currently, a lot of material based on phase space optics is been published showing that light propagation can be investigated using the phase space concept \cite{rausch2012phase,rausch2014phase, herkommer2012phase}. Also, phase space optics might constitute an alternative approach for describing aberration phenomena\cite{herkommer2013phase, babington2017freeform, wolf1993relativistic}. In this thesis we introduce new methods based on PS providing a new way to calculate the light distribution at the target of optical systems. The PS methods highly improve the performance of existing procedures used to this purpose in illumination optics, i.e., MC and QMC ray tracing. 
Next the methods and results are briefly discussed. 
\section{Phase space methods and results}
The new methods presented in this thesis are based on PS rays tracing.
Phase space ray tracing takes into account the sequence of the lines encountered by every ray traced, that is the \textit{ray path}. We focus on two different procedures: phase space ray tracing and inverse ray mapping in phase space. 
Considering for every ray traced its corresponding path, we observe that the PS of the source and the target are partitioned into peaches each of them is formed by the rays that follow the same path. The boundaries of these regions in target PS give important information about the output photometric variables because there the luminance has a jump discontinuity from a zero value to a positive value. LED light sources are usually Lambertian, i.e. they emit equal luminance in every direction \cite{taylor2000illumination}. For systems with a Lambertian source the boundaries of these regions give \textit{all} the information needed for computing the luminance and the intensity, as a consequence is not required to trace rays that will be located inside the regions with positive luminance in target PS.
In the general case of a non Lambertian source, a sample of rays inside the regions with positive luminance should be considered over all the possible directions to provide the profile of the output luminance. In case of a non Lambertian source, a numerical integration gives the target intensity profile. 
\\ \indent 
Our aim is to detect the boundaries of the regions with positive luminance so that the computation of the photometric variables can be quickly estimate without the need for tracing millions of rays. \\ \indent
\textit{Phase space ray tracing} is a forward ray tracing method that employs the source and the target PS representation of the optical systems. The key idea is to construct a nonuniform triangulation in PS such that more triangles are defined only where boundaries occur. The coordinates of the vertices of each triangles correspond to the coordinates of the rays traced.  For the sake of simplicity we construct the triangulation in source PS. The triangulation refinement provides a set of points where every point corresponds to the coordinates of the rays traced that will be located close to the regions with positive luminance in target PS. Next, the boundaries of the regions in source PS formed by the rays that follow the same path are approximated. To do that we provide two different approaches. \\ \indent
The first technique for the boundaries computation is based on $\alpha$-shape. 
The $\alpha$-shapes methods consider a triangulation (usually the Delanauy triangulation \cite{marsden2003texts}) of the set of point obtained from the triangulation refinement of the source PS. Then, the parameter $\alpha$ is used to decide which triangles have to be considered for the boundaries computation and which have to be removed. For every triangle the radius of its circumcircle is considered. If it is greater than $\alpha$, then the triangle is eliminated from the triangulation. Considering the edges of the remaining triangles belonging to only one triangle, the $\alpha$-shape of the points cloud is found. In general is not easy to establish the value of parameter $\alpha$ that gives the desired boundary computation \cite{teichmann1998surface}. We develop a procedure based on \'{e}tendue conservation for providing an estimation of the parameter $\alpha$ that gives a good approximation of the boundaries \cite{filosa2015new}. \\ \indent The second technique for the boundaries computation exploits the triangulation refinement explained above. The approximation of the boundaries in source PS is obtained by connecting the vertices of the triangles crossed by a boundary corresponding to the rays that follow the same path. The finer is the triangulation the more accurate the boundaries are. Etendue conservation is used to provide a stopping criterion to the triangulation refinement \cite{filosa2016ray, filosa2017phase}. \\ \indent  
Once the boundaries are calculated at the source PS, also the boundaries at the target are obtained (edge-ray principle, \cite{Ries:2}). Assuming a Lambertian source, the output intensity is calculated by only considering the rays located on these boundaries. Numerical results are provided both using $\alpha$-shapes and the triangulation refinement. To validate the method the intensities found are compared to both MC and QMC ray tracing. Numerical results demonstrate that using PS ray tracing leads to trace far less rays than MC ray tracing to obtain accurate approximation of the intensity profile. However, when using $\alpha$-shapes the number of rays traced depends on the complexity of the design of the optical system, while computing the boundaries employing the triangulation refinement, a speed of convergence proportional to the inverse of the number of rays traced is obtained for all the systems considered versus a speed of convergence proportional to the inverse of the square root of the number of rays traced obtained using MC ray tracing. PS ray tracing based on the triangulation refinement gives speed advantages also compared to QMC ray tracing when applied to some optical systems while it is slower than QMC for some other systems.
PS ray tracing is therefore further improved by introducing the inverse ray mapping method based on a ray mapping reconstruction in PS. 
\\ \indent
\textit{Inverse ray mapping in phase space} is first developed for systems formed by straight line segments. In this case the phase spaces of \textit{all} the lines that constitutes the system are considered. We assume that the optical lines are designed such that they can both receive and emit light while the source can only emit light and the target only receive it. Both source and target PS of each line are computed and only one PS is implemented for the source and the target. Concatenating all the phase spaces with two different maps, we are able to construct an inverse map from the target to the source. From here the name \textit{concatenated inverse ray mapping} for this method. Numerical results show that only the rays on the target PS that are located \textit{exactly} where the discontinuity of the luminance occurs are traced inside the system. The output intensity is computed integrating the luminance at the target PS. A comparison between concatenated inverse ray mapping and QMC ray tracing demonstrate that our method computes the \textit{exact} intensity reducing the computational time. \\ \indent In order to extend the method to system formed also by curved line we use a different approach which employs the PS representation of the target of the optical system. Applying a bisection method combined with inverse ray tracing we are able to construct the inverse map from the target to the source \textit{directly}. This allows tracing only the rays on the boundaries of the regions with positive luminance \cite{filosa2017inverse}. From these rays the output intensity is calculated. We show in simulations that \textit{direct inverse ray mapping} is more accurate and faster than QMC ray tracing. \\ \indent Finally direct inverse ray mapping is extended to systems with Fresnel reflections. In this case every ray incident a Fresnel lens with a angle different from the Brewster angle and the critical angles is split into the reflected and the refracted ray each of them transport a fraction of the energy of the incident ray. This leads to a multitude of possible paths. Direct inverse ray mapping is applied considering every possible path separately. Given a path the rays located on the boundary of the corresponding region in target PS are traced from the target to the source. Numerical simulations show that direct inverse ray mapping is able to detect \textit{all} the possible paths and to determine the boundaries of \textit{all} the regions with positive luminance in target PS. Since, for Fresnel systems the luminance is not constant at the target, a sample of rays inside those regions needs to be considered for calculating the luminance and the intensity profile.
\section{Content of this thesis}
This work is organized in the following way.\\ \indent
In Chapter \ref{chap:Illumination optics} an overview of the physical notion of Illumination optics used in this thesis is provided. After a short introduction of the radiometric variables, the photometric counterparts are defined. Reflection and refraction law are described and the total internal reflection is discussed. A description of Fresnel reflection is included. In this chapter we follow the literature reported in \cite{hecht1998hecht, feynman2011feynman, feynman1964feynman}.\\ \indent
Chapter \ref{chap:raytracing} includes the discussion of classical ray tracing. First, we introduce in details MC and QMC methods which are very often used in numerical integration. A mathematical formulation of both the methods is given. Second the MC and QMC ray tracing are discussed. They are based on a combination of MC and QMC procedures with ray tracing method. We explain how to calculate the target intensity using these techniques and numerical results for a simple system show the convergence of the approximated intensities to the exact intensity by increasing the number of rays traced.\\\indent
Chapter \ref{chap:PS} introduces the PS concept for two-dimensional optical systems. We show that the PS provides a complete description of the optical systems. We explain how construct the triangulation refinement on which PS ray tracing is based. The PS representation of the source and the target of a simple system (the two-faceted cup) shows that the phase spaces are divided into regions formed by the rays that follow the same path when they propagates through the system. Two techniques for calculating the boundaries of these regions are provided next. \\ \indent 
The method based on $\alpha$-shapes is presented in Chapter \ref{chap:boundaries_alpha}. A technique based on \'{e}tendue conservation is developed and numerical results for two different total internal reflection (TIR)-collimators are provided. For such systems also the target intensity in PS is calculated and it is compared with MC ray tracing. The chapter concludes with discussions of the results obtained.\\ \indent
A different approach for the boundaries calculation which employs a triangulation refinement in source PS is provided in Chapter \ref{chap:triangulation}. The method is applied to three different systems: the two-faceted cup, a TIR-collimator and a parabolic reflector and are compared with both MC and QMC ray tracing.
\\ \indent Next, a second method based on ray mapping reconstruction from the target to the source is developed. Chapter \ref{chap:raymapping1} includes the description of concatenated inverse ray mapping for systems formed by straight and reflective lines segments. The target intensity is computed for two different optical systems: the two-faceted cup and a multifaceted cup. Numerical results are compared to QMC ray tracing. \\ \indent Direct inverse ray mapping method extended to systems formed by curved and refractive lines is presented in
Chapter \ref{chap:raymapping2}. A detailed explanation of the idea and the algorithm used is given. The results for the TIR-collimator and the parabolic reflector validate the method showing that it calculates the intensity correctly compared to QMC ray tracing. \\ \indent
The research concludes with Chapter \ref{chap:fresnel} which contains the numerical inverse ray mapping applied to systems with Fresnel reflection. The theoretical explanation of the method is followed by numerical results applied to a system formed by the source, the target and a simple convex Fresnel lens. We show in simulations that the boundaries of the regions with positive luminance are calculated correctly. Finally, we explain in theory how to calculate the luminance and the intensity. \\ \indent Chapter \ref{chap:conclusions} presents discussions and insights for future prospective.
\clearpage{\pagestyle{empty}\cleardoublepage}
 